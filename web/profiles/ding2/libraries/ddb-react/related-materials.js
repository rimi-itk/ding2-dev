(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{286:function(e,t,r){"use strict";r.r(t);var a=r(16),n=(r(48),r(28),r(33),r(164),r(146),r(253),r(66),r(34),r(151),r(53),r(54),r(44),r(254),r(83),r(257),r(162),r(259),r(55),r(1)),i=r.n(n),c=(r(45),r(5)),o=r.n(c),s=r(4),l=r.n(s),u=r(3),d=r.n(u),f=r(0),m=r.n(f),p=(r(2),r(13),r(118)),v=r.n(p),h=r(12),b=r(18);function y(){return m.a.createElement("div",{className:"ddb-related-material ddb-related-material__skeleton"},m.a.createElement(h.a,{mr:0,ml:0,mb:0,mt:0,height:"100%",width:"100%"}))}function g(e){var t=e.pid,r=e.type,a=e.title,n=e.creators,i=e.year,c=e.cover,o=e.materialUrl,s=Object(f.useState)("initial"),u=l()(s,2),d=u[0],p=u[1],v=c.imageUrls.large.url,h=n.join(", "),y="".concat(r," - ").concat(h,": ").concat(a," (").concat(i,")");return m.a.createElement("a",{className:"ddb-related-material ".concat("finished"===d&&"ddb-related-material--finished"),href:Object(b.a)({text:o,placeholders:{pid:encodeURI(t)}})},m.a.createElement("img",{onLoad:function(){return p("finished")},alt:y,src:v}))}function j(e){var t=e.items,r=e.status,a=e.searchUrl,n=e.materialUrl,i=e.searchText,c=e.titleText;return"failed"===r||"empty"===r?null:m.a.createElement("div",{className:"ddb-related-materials"},m.a.createElement("h2",{className:"ddb-reset ddb-related-materials__title"},c),m.a.createElement("ul",{className:"ddb-reset ddb-related-materials__list"},t.map((function(e){return e.data?m.a.createElement("li",{key:e.id},m.a.createElement(g,{pid:e.data.pid,title:e.data.title,creators:e.data.creators,type:e.data.type,year:e.data.year,cover:e.data.cover,materialUrl:n})):m.a.createElement("li",{key:e.id},m.a.createElement(y,null))}))),m.a.createElement("a",{className:"ddb-related-materials__search",href:a},i))}g.defaultProps={creators:[]},j.defaultProps={items:[]};var O=j,w=r(46),x=r(88),E=r(89);function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(r,!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(){return(P=d()(i.a.mark((function e(){var t,r,a,n,c,o,s,l,u,d,f,m,p,v,h,b=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v=function(e){var t=p.find((function(t){return e.pid[0]===t.id}));return U({},E.a.format(e),{cover:t})},t=b.length>0&&void 0!==b[0]?b[0]:{},r=t.query,a=t.offset,n=t.limit,c=t.fields,o=t.sort,s=t.coverClient,c.includes("pid")){e.next=4;break}throw Error('"pid" must be included as a field.');case 4:return l=new w.a,e.next=7,l.search(r,{offset:a,limit:n,fields:c,sort:o});case 7:return u=e.sent,d=u.map((function(e){return e.pid[0]})),f="large",e.next=12,s.getCover({id:d,size:[f]});case 12:return m=e.sent,p=m.filter((function(e){var t;return null===(t=e.imageUrls[f])||void 0===t?void 0:t.url})),h=u.map(v),e.abrupt("return",h.filter((function(e){return e.cover})));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.query,r=e.amount,a=void 0===r?10:r,n=e.maxTries,i=void 0===n?10:n,c=e.fields,o=e.sort,s=e.coverClient,u=Object(f.useRef)({status:"ready",tries:0,offset:0,materials:Array.from(new Array(a)).map((function(e,t){return{id:t+1,data:void 0}}))}),d=Object(f.useState)({}),m=l()(d,2),p=m[0],v=m[1];Object(f.useEffect)((function(){v(u.current)}),[u,t]);return Object(f.useEffect)((function(){var e,r,n=(null==p?void 0:null===(e=p.materials)||void 0===e?void 0:null===(r=e.filter((function(e){return!e.data})))||void 0===r?void 0:r.length)||0;if(n&&p.tries<i){var l=Math.ceil(n*(p.tries+1)*1.2),u=Math.min(l,50);(function(){return P.apply(this,arguments)})({query:t,limit:u,offset:p.offset,fields:c,sort:o,coverClient:s}).then((function(e){var t,r=0,n=(null==p?void 0:p.materials.map((function(t){if(!t.data){var a=U({},t,{data:e[r]});return r+=1,a}return t})))||[],c=(null==n?void 0:null===(t=n.filter((function(e){return e.data})))||void 0===t?void 0:t.length)||0,o=p.tries+1,s=c>=a||o>=i?c>0?"finished":"empty":"processing";v({status:s,tries:o,offset:p.offset+u,materials:"finished"===s?n.filter((function(e){return e.data})):n})})).catch((function(){v({status:"failed"})}))}}),[a,s,c,u,i,t,p,o]),p}function k(e){return v()(e,"\\,","\n").split(/,/).map((function(e){return v()(e,"\n",",")})).map((function(e){return e.trim()})).filter((function(e){return e}))}function N(e,t){var r=U({operator:"or",negate:!1},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),a=t.map((function(e){return'"'.concat(e,'"')})).join(" ".concat(r.operator," ")),n="".concat(e,"=(").concat(a,")");return(r.negate?"not ":"")+n}function S(e){var t=e.subjects,r=e.categories,a=e.sources,n=e.excludeTitle,i=e.sort,c=e.searchUrl,o=e.materialUrl,s=e.coverServiceUrl,l=e.titleText,u=e.searchText,d=e.amount,f=e.maxTries,p=e.agencyId,v=new x.a({baseUrl:s}),h=[];if(t){var y=k(t);h.push(N("phrase.subject",y))}if(r){var g=k(r);h.push(N("term.category",g))}if(a){var j=k(a);h.push(N("term.acSource",j))}h.length<1&&h.push("*");var w=[];n&&w.push(N("phrase.title",[n],{negate:!0}));var E=[h.join(" and "),w.join(" ")].join(" ");if(p){var T=N("holdingsitem.agencyid",[p]);E="".concat(E," and ").concat(T)}var U="".concat(Object(b.a)({text:c,placeholders:{query:encodeURI(E),sort:encodeURI(i)}})),P=_({query:E,fields:["dcTitleFull","pid","dcCreator","creator","typeBibDKType","date"],sort:i,amount:d,maxTries:f,coverClient:v});return m.a.createElement(O,{status:P.status,items:P.materials,searchUrl:U,materialUrl:o,searchText:u,titleText:l})}S.defaultProps={amount:10,maxTries:5,titleText:"Forslag med samme emner",searchText:"Søg på samme emner",sort:"date_descending",agencyId:""};var C=S;Object(a.a)({appName:"related-materials",app:C})}},[[286,1,0]]]);
//# sourceMappingURL=related-materials.js.map